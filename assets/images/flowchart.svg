<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 950">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
    <filter id="shadow" x="-5%" y="-5%" width="110%" height="110%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-color="#000" flood-opacity="0.2"/>
    </filter>
  </defs>
  
  <rect width="100%" height="100%" fill="#ffffff" />
  
  <!-- STYLES -->
  <style>
    .start-end { fill: #ffe0b2; stroke: #e65100; stroke-width: 2; }
    .process { fill: #e3f2fd; stroke: #1565c0; stroke-width: 2; }
    .decision { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 2; }
    .io { fill: #fff9c4; stroke: #fbc02d; stroke-width: 2; }
    .text { font-family: Arial, sans-serif; font-size: 14px; text-anchor: middle; fill: #333; }
    .step-label { font-family: Arial, sans-serif; font-size: 10px; font-weight: bold; fill: #0d47a1; }
    .line { stroke: #333; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead); }
    .label { font-family: Arial, sans-serif; font-size: 11px; fill: #555; background-color: white; }
  </style>

  <!-- NODES -->
  
  <!-- STEP 1: START -->
  <g transform="translate(300, 20)">
    <rect x="0" y="0" width="200" height="40" rx="20" class="start-end" filter="url(#shadow)"/>
    <text x="100" y="25" class="text" font-weight="bold">STEP 1: START</text>
  </g>

  <!-- STEP 2: Load Binary -->
  <g transform="translate(300, 90)">
    <path d="M 20,0 L 200,0 L 180,50 L 0,50 Z" class="io" filter="url(#shadow)"/>
    <text x="100" y="20" class="step-label">STEP 2</text>
    <text x="100" y="38" class="text">Load Binary File</text>
  </g>

  <!-- STEP 3: Validate (Decision) -->
  <g transform="translate(300, 180)">
    <path d="M 100,0 L 200,50 L 100,100 L 0,50 Z" class="decision" filter="url(#shadow)"/>
    <text x="100" y="45" class="step-label">STEP 3</text>
    <text x="100" y="65" class="text">Valid ELF?</text>
  </g>

  <!-- STEP 4: Static Analysis -->
  <g transform="translate(300, 320)">
    <rect x="0" y="0" width="200" height="60" class="process" filter="url(#shadow)"/>
    <text x="100" y="20" class="step-label">STEP 4</text>
    <text x="100" y="40" class="text">Static Analysis</text>
  </g>

  <!-- STEP 5: Dynamic Fuzzing -->
  <g transform="translate(300, 420)">
    <rect x="0" y="0" width="200" height="60" class="process" filter="url(#shadow)"/>
    <text x="100" y="20" class="step-label">STEP 5</text>
    <text x="100" y="40" class="text">Dynamic Fuzzing</text>
  </g>

  <!-- Decision: Crash Detected? (Part of Step 5 logic) -->
  <g transform="translate(300, 520)">
    <path d="M 100,0 L 200,50 L 100,100 L 0,50 Z" class="decision" filter="url(#shadow)"/>
    <text x="100" y="55" class="text">Crash / Leak?</text>
  </g>
  
  <!-- Loop back for fuzzing -->
  <g transform="translate(60, 520)">
     <rect x="0" y="20" width="100" height="40" class="process" filter="url(#shadow)"/>
     <text x="50" y="45" class="text" font-size="12px">Next Input</text>
  </g>

  <!-- STEP 6: Exploit Gen -->
  <g transform="translate(600, 680)">
    <rect x="0" y="0" width="180" height="60" class="process" filter="url(#shadow)"/>
    <text x="90" y="20" class="step-label">STEP 6</text>
    <text x="90" y="40" class="text">Gen Exploit</text>
  </g>

  <!-- Step 5.3: Calculate Offset (helper) -->
  <g transform="translate(580, 540)">
     <rect x="0" y="0" width="160" height="40" class="process" filter="url(#shadow)"/>
     <text x="80" y="25" class="text" font-size="12px">Calc Offset</text>
  </g>

  <!-- STEP 7: Output -->
  <g transform="translate(300, 780)">
    <path d="M 20,0 L 200,0 L 180,50 L 0,50 Z" class="io" filter="url(#shadow)"/>
    <text x="100" y="20" class="step-label">STEP 7</text>
    <text x="100" y="38" class="text">Save Output</text>
  </g>

  <!-- STEP 8: END -->
  <g transform="translate(300, 880)">
    <rect x="0" y="0" width="200" height="40" rx="20" class="start-end" filter="url(#shadow)"/>
    <text x="100" y="25" class="text" font-weight="bold">STEP 8: END</text>
  </g>


  <!-- CONNECTIONS -->
  <path d="M 400,60 L 400,85" class="line"/> <!-- 1->2 -->
  <path d="M 400,140 L 400,175" class="line"/> <!-- 2->3 -->

  <!-- 3 -> 4 (Yes) -->
  <path d="M 400,280 L 400,315" class="line"/>
  <text x="410" y="300" class="label">Yes</text>

  <!-- 3 -> 2 (No/Error) Loop back -->
  <path d="M 300,230 L 150,230 L 150,115 L 295,115" class="line"/>
  <text x="200" y="225" class="label">No (Invalid)</text>

  <path d="M 400,380 L 400,415" class="line"/> <!-- 4->5 -->
  <path d="M 400,480 L 400,515" class="line"/> <!-- 5->Decision -->

  <!-- Decision -> Calc Offset (Yes) -->
  <path d="M 500,570 L 575,570" class="line"/>
  <text x="520" y="565" class="label">Yes</text>
  
  <!-- Calc Offset -> 6 -->
  <path d="M 660,580 L 660,675" class="line"/>

  <!-- Decision -> Loop (No) -->
  <path d="M 300,570 L 240,570 L 165,570" class="line"/>
  <text x="245" y="565" class="label">No</text>
  
  <!-- CORRECTED LOOP PATH - REMOVED STRAY DIAGONAL -->
  <path d="M 110,520 L 110,450 L 295,450" class="line"/> 

  <!-- 6 -> 7 -->
  <path d="M 690,740 L 690,805 L 485,805" class="line"/>

  <!-- 7 -> 8 -->
  <path d="M 400,830 L 400,875" class="line"/>

</svg>
